# シナリオ8: ランタイム脆弱性の優先順位付け

## 📋 シナリオ概要

### 目的
実行中のコンテナに存在する脆弱性を、実際の露出度・権限・ネットワークアクセスに基づいて優先順位付けし、対処すべき脆弱性を絞り込む能力を検証します。

### 検証内容
- ✅ 実行中vs停止中のコンテナの脆弱性を比較
- ✅ ランタイムコンテキスト（Exposed to Internet, Privileged等）の確認
- ✅ リスクスコアによる優先順位付け
- ✅ 修正優先度の高い脆弱性の特定

---

## ⏱️ 所要時間

| フェーズ | 所要時間 |
|---------|---------|
| **Wiz確認と分析** | 20-30分 |

---

## 📋 前提条件

### ✅ 必須要件
- [x] **S07完了**: ECSタスクが実行中で、Code-to-Cloud連携済み
- [x] **複数イメージ**: 実行中と未使用のイメージが両方存在する

---

## 🔧 手順1: 実行中コンテナの脆弱性確認

### 1.1 実行中のイメージのみフィルター

```
Wizコンソール > Code > Container Images

フィルター適用:
- Runtime Status: Running
- Registry: ECR
```

### 1.2 ランタイムコンテキストを確認

**確認項目**:
```
✅ Exposed to Internet: ALB経由でインターネットに公開
✅ Has Vulnerabilities: 脆弱性の有無
✅ Privileged: 特権モードで実行されているか
✅ Network Access: VPC内部のみ、またはパブリックサブネット
```

---

## 🔧 手順2: 優先順位付けの比較

### 2.1 実行中vs未使用の比較

| 指標 | 実行中コンテナ | 未使用イメージ |
|------|-------------|-------------|
| **脆弱性数** | 例: 45個 | 例: 45個（同じ） |
| **優先度** | **Critical/High** | Low |
| **理由** | 実際に攻撃可能 | 未使用のため影響なし |
| **対処必要性** | **即座に対応** | 次回ビルド時に対応 |

### 2.2 Wiz Risk Scoreの確認

```
1. 実行中のイメージを選択
2. Vulnerabilitiesタブを開く
3. Risk Scoreでソート
   - Critical + Exploited in the Wild: 最優先
   - Critical + Public Exploit Available: 次優先
   - High + Runtime Context: 優先
```

---

## ✅ 検証完了チェックリスト

- [ ] **実行中フィルター**: 実行中のコンテナのみが表示された
- [ ] **ランタイムコンテキスト**: Exposed, Privileged等が確認できた
- [ ] **優先順位**: リスクスコアで脆弱性が優先順位付けされた
- [ ] **比較**: 実行中と未使用イメージの脆弱性が区別された

---

## 🎯 次のステップ

- [S09: IaC Drift検出](S09-iac-drift-detection.md)

---

**✅ S08検証完了**: ランタイムコンテキストによる優先順位付けが確認できました。
